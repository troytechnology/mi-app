<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Playbook</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>ðŸ“‘ Playbook</h1>
    <button onclick="window.location.href='index.html'">â¬… Volver</button>

    <div>
      <h3>Subir Archivo Excel</h3>
      <input type="file" id="excelFile" accept=".xlsx,.xls">
      <button id="uploadExcel">Actualizar</button>
    </div>

    <div style="margin-top:20px;">
      <table id="excelTable" class="display" style="width:100%"></table>
    </div>
  </div>

  <!-- ðŸ”¹ El script va dentro de <script> -->
  <script>
    const excelInput = document.getElementById("excelFile");
    const uploadBtn = document.getElementById("uploadExcel");
    const excelTable = document.getElementById("excelTable");

    function renderTable(data) {
      if ($.fn.DataTable.isDataTable("#excelTable")) {
        $("#excelTable").DataTable().destroy();
      }
      excelTable.innerHTML = "";

      const colCount = data[0].length;
      const normalizedData = data.map(row => {
        const newRow = [...row];
        while (newRow.length < colCount) newRow.push("");
        if (newRow.length > colCount) newRow.length = colCount;
        return newRow;
      });

      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");
      normalizedData[0].forEach(header => {
        const th = document.createElement("th");
        th.textContent = header;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      excelTable.appendChild(thead);

      const tbody = document.createElement("tbody");
      normalizedData.slice(1).forEach(row => {
        const tr = document.createElement("tr");
        row.forEach(cell => {
          const td = document.createElement("td");
          td.textContent = cell ?? "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      excelTable.appendChild(tbody);

      const table = $("#excelTable").DataTable({
        paging: true,
        searching: true,
        ordering: true,
        pageLength: 15,
        scrollX: true,
        language: { url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json" }
      });

      $("#excelTable thead th").each(function () {
        const title = $(this).text();
        $(this).html(title + '<br><input type="text" placeholder="Filtrar" style="width:100%"/>');
      });

      table.columns().every(function () {
        const that = this;
        $("input", this.header()).on("keyup change clear", function () {
          if (that.search() !== this.value) {
            that.search(this.value).draw();
          }
        });
      });
    }

    uploadBtn.addEventListener("click", () => {
      if (excelInput.files.length === 0) {
        alert("Seleccione un archivo Excel.");
        return;
      }
      const file = excelInput.files[0];
      const reader = new FileReader();
      reader.onload = (e) => {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheetName = workbook.SheetNames[0];
        const sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], { header: 1 });
        localStorage.setItem("excelData", JSON.stringify(sheet));
        renderTable(sheet);
      };
      reader.readAsArrayBuffer(file);
    });

    document.addEventListener("DOMContentLoaded", () => {
      const savedData = localStorage.getItem("excelData");
      if (savedData) {
        renderTable(JSON.parse(savedData));
      }
    });
  </script>
</body>
</html>







